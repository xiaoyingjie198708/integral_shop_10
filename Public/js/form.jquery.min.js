(function($) {
    $.fn.form=(function(options) {
        var _param = {radio:{},checkbox:{},error:function(data,obj){alert(data);},ajaxcallback:function(data){},start:function(){}};
        $.extend(_param,options);
        var _this = $(this);
        _this.submit(function() {
            if(_param.start() === false) return false;
//            if(_this.data('send') == 'off') return false;
            var _nodes = _this.find('input,textarea,select');
            for (var i=0; i<_nodes.length; i++) {
                var _the = $(_nodes[i]);
                if (_nodes[i].tagName == 'INPUT') {
                    if (_the.attr('type') == 'text') {
                        if(_the.attr('empty') && $.trim(_the.val()) == ''){
                            _param.error(_the.attr('empty'),_the);
                            _the.focus();
                            return false;
                        }
                        if (_the.attr('email')) {
                            if (!$.checkEmail($.trim(_the.val()))) {
                                _param.error(_the.attr('email'),_the);
                                _the.focus();
                                return false;
                            }
                        }
                        if (_the.attr('mobile')) {
                            if (!$.checkMobile($.trim(_the.val()))) {
                                _param.error(_the.attr('mobile'),_the);
                                _the.focus();
                                return false;
                            }
                        }
                        if (_the.attr('regex')) {
                            var _reg = eval(_the.attr('regex'));
                            var _bool = _reg.test($.trim(_the.val()));
                            if (!_bool) {
                                _param.error(_the.attr('regexMsg')?_the.attr('regexMsg'):'error',_the);
                                _the.focus();
                                return false;
                            }
                        }
                        if (_the.attr('number')) {
                            var _bool = /^\d+$/.test($.trim(_the.val()));
                            if ($.trim(_the.val()) && !_bool) {
                                _param.error(_the.attr('number'),_the);
                                _the.focus();
                                return false;
                            }
                        }
                    }else if (_the.attr('type') == 'radio') {
                        if (_param.radio.length > 0) {
                            var _check_radio = true;
                            for (var j=0; j<_param.radio.length; j++) {
                                if (_the.attr('name') == _param.radio[j].name) {
                                    if (_this.find(':radio[name='+_the.attr('name')+'][checked=checked]').length <= 0) {
                                        _param.error(_param.radio[j].msg,_the);
                                        _check_radio = false;
                                    }
                                    break;
                                }
                            }
                            if (!_check_radio) return false;
                        }
                    }else if (_the.attr('type') == 'checkbox') {
                        if (_param.checkbox.length > 0) {
                            var _check_checkbox = true;
                            for (var j=0; j<_param.checkbox.length; j++) {
                                if (_the.attr('name') == _param.checkbox[j].name) {
                                    var _check_box_length = _this.find(':checkbox[name='+_the.attr('name')+'][checked=checked]').length;
                                    if (_check_box_length < _param.checkbox[j].min || _check_box_length > _param.checkbox[j].max) {
                                        _param.error(_param.checkbox[j].msg,_the);
                                        _check_checkbox = false;
                                    }
                                    break;
                                }
                            }
                            if (!_check_checkbox) return false;
                        }
                    }else {
                        if(_the.attr('empty') && $.trim(_the.val()) == ''){
                            _param.error(_the.attr('empty'),_the);
                            _the.focus();
                            return false;
                        }
                        if (_the.attr('pwd') && _the.attr('msg')) {
                            if (_the.val() != $('#'+_the.attr('pwd')).val()) {
                                _param.error(_the.attr('msg'),_the);
                                _the.focus();
                                return false;
                            }
                        }
                    }
                }else if (_nodes[i].tagName == 'TEXTAREA') {
                    if(_the.attr('empty') && $.trim(_the.val()) == ''){
                        _param.error(_the.attr('empty'),_the);
                        _the.focus();
                        return false;
                    }
                    if (Number(_the.attr('min')) > $.trim(_the.val()).length || $.trim(_the.val()).length > Number(_the.attr('max'))) {
                        _param.error(_the.attr('textMsg'),_the);
                        _the.focus();
                        return false;
                    }
                }else {
                    if(_the.attr('empty') && $.trim(_the.val()) == ''){
                        _param.error(_the.attr('empty'),_the);
                        _the.focus();
                        return false;
                    }
                }
            }
            _this.data('send','off');
            if (_this.attr('ajax') == 'true') {
                switch (_this.attr('method')) {
                    case 'get':$.get(_this.attr('action'),_this.serialize(),function(data) {
                        _this.data('send','on');
                        _param.ajaxcallback(data);
                    },'json');break;
                    case 'post':$.post(_this.attr('action'),_this.serialize(),function(data) {
                        _this.data('send','on');
                        _param.ajaxcallback(data);
                    },'json');break;
                    default:$.post(_this.attr('action'),_this.serialize(),function(data) {
                        _this.data('send','on');
                        _param.ajaxcallback(data);
                    },'json');break;
                }
                return false;
            }
        });
    });
    $.checkMobile=(function(_mobile) {
        return /^1[3-9]{1}[0-9]{9}$/.test(_mobile);
    });
    $.checkEmail=(function(_email) {
        return /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/.test(_email);
    });
})(jQuery);